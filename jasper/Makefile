CC=gcc
LIBS=-lws2_32
CFLAGS=-Os -Wall -s
OBJS=backend.o list.o portspec.o cmdline.o

default: jasper.exe

backend.o: backend.c backend.h
	$(CC) $(CFLAGS) -c backend.c
	
list.o: list.c list.h
	$(CC) $(CFLAGS) -c list.c

portspec.o: portspec.c portspec.h
	$(CC) $(CFLAGS) -c portspec.c
	
jasper.exe: main.c $(OBJS)
	$(CC) $(CFLAGS) -o jasper.exe main.c $(OBJS) $(LIBS)
	strip --strip-all jasper.exe
	
cmdline.o: cmdline.c cmdline.h
	$(CC) $(CFLAGS) -c cmdline.c

test: test.c portspec.o list.o
	$(CC) $(CFLAGS) -o test.exe test.c list.o portspec.o $(LIBS)

clean:
	rm *.o
	rm *.exe